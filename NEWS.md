# История изменений Phobos

## Таблица изменений

| Дата | Что сделано | Почему (причина, проблема) |
|------|-------------|----------------------------|
| **2025-11-12** | Добавлена поддержка роутеров OpenWrt | Расширение поддерживаемых платформ - теперь Phobos работает не только на Keenetic |
| 2025-11-12 | Создан `router-configure-wireguard-openwrt.sh` | Автоматическая настройка WireGuard через UCI на OpenWrt роутерах |
| 2025-11-12 | Обновлен `install-router.sh` с автоопределением платформы | Универсальный установщик для Keenetic и OpenWrt - автоматический выбор метода настройки |
| 2025-11-12 | Архитектурная оптимизация wg-obfuscator (AVX2/NEON) | Повышение производительности обфускации на x86/ARM процессорах с SIMD инструкциями |
| 2025-11-12 | Добавлены бинарники wg-obfuscator для x86 и armv7 | Поддержка роутеров на x86 архитектуре и старых ARM устройств (armv7) |
| 2025-11-12 | Обновлен `vps-generate-package.sh` для OpenWrt | Генерация пакетов с конфигурацией для обеих платформ (Keenetic и OpenWrt) |
| 2025-11-12 | Обновлены `router-health-check.sh` и `router-uninstall.sh` | Поддержка проверки состояния и удаления на Keenetic и OpenWrt |
| 2025-11-12 | Улучшен `detect-router-arch.sh` | Определение платформы OpenWrt/LEDE и выбор правильной директории установки |
| **2025-11-10** | Критический апдейт безопасности HTTP сервера | HTTP сервер показывал листинг директорий - любой мог получить доступ к полным архивам пакетов и токенам через браузер |
| 2025-11-10 | Создан безопасный `phobos-http-server.py` | Блокирует листинг директорий, отдает файлы только по прямым ссылкам, защита от path traversal |
| 2025-11-10 | Обновлен `vps-start-http-server.sh` | Интеграция безопасного HTTP сервера вместо стандартного `python3 -m http.server` |
| **2025-11-09** | Обновлена документация (README.md, docs/) | Отражение всех изменений в проекте, удаление устаревшей информации |
| 2025-11-09 | Добавлена проверка внешнего IP для активных WireGuard туннелей | Health check не показывал реальный внешний IP туннелей - невозможно было проверить что туннель действительно работает |
| 2025-11-09 | Исправлен парсинг JSON с jq во всех скриптах роутера | Некорректная работа с JSON через grep/cut приводила к ошибкам при поиске и удалении интерфейсов |
| 2025-11-09 | Добавлена автоматическая установка jq на роутере | jq необходим для корректного парсинга JSON от RCI API роутера Keenetic |
| 2025-11-09 | Исправлен `router-configure-wireguard.sh` | Скрипт не находил созданный интерфейс "Phobos-XXX" из-за некорректного парсинга JSON |
| 2025-11-09 | Создан `router-uninstall.sh` с поддержкой jq | Автоматическое удаление всех компонентов Phobos с роутера через RCI API |
| 2025-11-09 | Обновлен `router-health-check.sh` | Использование jq для проверки WireGuard интерфейсов, отображение внешних IP |
| 2025-11-09 | Увеличена пауза перед проверкой интерфейса (2→5 сек) | Система не успевала применить конфигурацию WireGuard |
| 2025-11-09 | Интеллектуальная генерация портов (100-700) | Старый диапазон 10000-60000 мог конфликтовать с другими сервисами |
| 2025-11-09 | Функция `generate_safe_port()` с исключениями | Автоматическое исключение IANA зарезервированных портов, часто используемых портов, занятых портов |
| 2025-11-09 | Автоматическое определение IPv6 с двойной проверкой | Ненадежное определение IPv6 через один сервис давало ложные результаты |
| 2025-11-09 | Два независимых метода проверки IPv6 с перекрестной валидацией | Гарантирует достоверность определения публичного IPv6 адреса |
| 2025-11-09 | Удалены ненужные зависимости (build-essential, git, make, gcc, g++) | Уменьшение размера установки, ускорение развертывания - компиляция не требуется |
| 2025-11-09 | Добавлена остановка сервисов перед переустановкой | Конфликты при обновлении из-за запущенных процессов |
| 2025-11-09 | `vps-wg-setup.sh` - остановка WireGuard перед настройкой | Избежание ошибок при переконфигурации |
| 2025-11-09 | `vps-obfuscator-setup.sh` - остановка obfuscator перед установкой | Избежание конфликтов портов |
| 2025-11-09 | `vps-start-http-server.sh` - остановка HTTP сервера | Корректное обновление конфигурации |
| 2025-11-09 | `install-router.sh` - остановка wg-obfuscator перед установкой | Избежание ошибок при переустановке на роутере |
| 2025-11-09 | Развертывание скрипта `router-uninstall.sh` при установке | Удобное удаление Phobos с роутера без ручных команд |
